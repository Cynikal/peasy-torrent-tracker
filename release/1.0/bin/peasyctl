#!/bin/sh

# Most of this file was taken from the ejabberd project and then changed
#  until it matched what we had as a goal

NODE=peasy
HOST=localhost

PATHS="-pa ./release/1.0/peasy/lib/peasy-1.0/ebin -pa ./release/1.0/peasy/lib/peasy-1.0/ebin"
CONFIGFILE=./release/1.0/peasy/lib/peasy-1.0/priv/peasy.config
ERL_FLAGS="+Ktrue +A 128"

start () {
    erl ${ERL_FLAGS} -sname ${NODE}@${HOST} ${PATHS} \
	-config ${CONFIGFILE} -noshell -noinput -detached \
	-s peasy start -s appmon start -cookie peasy
}

debug () {
    erl -sname debug${NODE}@${HOST} \
	-pa ${BEAMDIR} \
	-remsh ${NODE}@${HOST}
}

ctl () {
    erl -noinput -sname etorrentctl@${HOST} \
	-pa ${BEAMDIR} \
	-s peasy_ctl start ${NODE}@${HOST} $@
}

usage () {
    echo "Usage: $0 {start|stop|debug}"
}

[ $# -lt 1 ] && usage

case $1 in
    start) start;;
    debug) debug;;
    *) ctl $@;;
esac
