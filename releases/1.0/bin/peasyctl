#!/bin/sh

# Most of this file was taken from the ejabberd project and then changed
#  until it matched what we had as a goal

NODE=peasy
HOST=localhost

PATHS="-pa ./releases/1.0/peasy/lib/peasy-1.0/ebin -pa ./releases/1.0/peasy/lib/mochiweb/ebin"
CONFIGFILE=./releases/1.0/peasy/lib/peasy-1.0/priv/peasy.config
ERL_FLAGS="+Ktrue +A 128"

start () {
    erl ${ERL_FLAGS}  ${PATHS} \
	-config ${CONFIGFILE}  -detached -noshell -noinput \
	-s peasy start -sname peasy -cookie peasy -sname peasy_main@localhost
}

debug () {
    erl -sname debug${NODE}@${HOST} \
	-pa ${BEAMDIR} \
	-remsh ${NODE}@${HOST}
}

ctl () {
    erl -noinput -detached -noshell -sname etorrentctl@${HOST} \
    -cookie peasy \
	${PATHS} \
	-s peasy stop peasy_main@localhost
}

usage () {
    echo "Usage: $0 {start|stop|debug}"
}

[ $# -lt 1 ] && usage

case $1 in
    start) start;;
    debug) debug;;
    *) ctl $@;;
esac
